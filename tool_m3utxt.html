<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>直播源格式转换器</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    
    <!-- 配置Tailwind自定义颜色和字体，模拟Mac风格 -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        mac: {
                            bg: '#f0f7ff', // 浅蓝色背景
                            card: '#ffffff',
                            border: '#ddeaff', // 浅蓝色边框
                            shadow: 'rgba(149, 157, 165, 0.1)',
                            accent: '#4a90e2', // 主色调：柔和蓝
                            purple: '#9b7bed', // 淡紫色
                            orange: '#ff8c42', // 珊瑚橙
                            green: '#56c596', // 薄荷绿
                            blue: '#4a90e2',  // 柔和蓝
                            text: '#2c3e50',  // 深灰色文字
                            textLight: '#7f8c8d' // 浅灰色文字
                        }
                    },
                    fontFamily: {
                        sans: ['-apple-system', 'BlinkMacSystemFont', 'Segoe UI', 'Roboto', 'Helvetica', 'Arial', 'sans-serif']
                    },
                    boxShadow: {
                        'mac': '0 4px 20px rgba(149, 157, 165, 0.1)',
                        'mac-hover': '0 6px 24px rgba(149, 157, 165, 0.15)'
                    }
                }
            }
        }
    </script>
    
    <style type="text/tailwindcss">
        @layer utilities {
            .mac-transition {
                transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            }
            .mac-button-active {
                transform: scale(0.98);
                box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1);
            }
        }
    </style>
</head>
<body class="bg-mac-bg min-h-screen flex items-center justify-center p-4 font-sans text-mac-text">
    <!-- 主容器 -->
    <div class="bg-mac-card rounded-xl shadow-mac w-full max-w-2xl overflow-hidden mac-transition hover:shadow-mac-hover">
        <!-- 顶部标题栏，模拟Mac窗口风格 -->
        <div class="h-6 bg-gradient-to-r from-red-400 via-yellow-400 to-green-400 px-3 flex items-center space-x-2">
            <div class="w-3 h-3 rounded-full bg-red-400"></div>
            <div class="w-3 h-3 rounded-full bg-yellow-400"></div>
            <div class="w-3 h-3 rounded-full bg-green-400"></div>
        </div>
        
        <!-- 内容区域 -->
        <div class="p-8">
            <h1 class="text-2xl font-semibold mb-8 text-center tracking-tight">直播源格式转换器</h1>
            
            <!-- 转换功能区域 -->
            <div class="mb-8 p-6 bg-mac-bg rounded-lg border border-mac-border">
                <h2 class="text-lg font-medium mb-4 text-mac-text">M3U 转 TXT（保留分组信息）</h2>
                <form id="m3u-to-txt-form" class="space-y-4">
                    <input type="file" id="m3u-file" accept=".m3u" required="" 
                           class="w-full p-3 bg-white border border-mac-border rounded-lg focus:ring-2 focus:ring-mac-accent focus:border-transparent outline-none mac-transition">
                    <button type="submit" 
                            class="w-full bg-mac-blue text-white py-3 px-4 rounded-lg hover:bg-opacity-90 active:mac-button-active mac-transition flex items-center justify-center">
                        <i class="fa fa-exchange mr-2"></i> 转换
                    </button>
                </form>
            </div>

            <div class="p-6 bg-mac-bg rounded-lg border border-mac-border">
                <h2 class="text-lg font-medium mb-4 text-mac-text">TXT 转 M3U（保留分组信息）</h2>
                <form id="txt-to-m3u-form" class="space-y-4">
                    <input type="file" id="txt-file" accept=".txt" required="" 
                           class="w-full p-3 bg-white border border-mac-border rounded-lg focus:ring-2 focus:ring-mac-accent focus:border-transparent outline-none mac-transition">
                    <input type="text" id="epg-url" placeholder="EPG URL (可选,默认为 https://epg.112114.xyz/pp.xml)" 
                           class="w-full p-3 bg-white border border-mac-border rounded-lg focus:ring-2 focus:ring-mac-accent focus:border-transparent outline-none mac-transition text-sm">
                    <button type="submit" 
                            class="w-full bg-mac-green text-white py-3 px-4 rounded-lg hover:bg-opacity-90 active:mac-button-active mac-transition flex items-center justify-center">
                        <i class="fa fa-exchange mr-2"></i> 转换
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- 提示消息区域 - Mac风格通知 -->
    <div id="notification" class="fixed top-6 right-6 px-6 py-3 rounded-lg shadow-lg transform translate-x-full transition-transform duration-300 flex items-center space-x-2 max-w-xs"></div>
    
    <!-- 备用复制区域 (隐藏) -->
    <textarea id="copy-backup" class="hidden"></textarea>

    <script>
        // 复制功能相关代码已移除，因为相关按钮已删除
        
        // 转换功能代码保持不变
        function parseM3UToTXT(m3uContent) {
            const lines = m3uContent.split('\n');
            const channels = {};
            let currentGroup = '未分组';

            for (let i = 0; i < lines.length; i++) {
                const line = lines[i].trim();
                if (line.startsWith('#EXTINF:-1')) {
                    const groupMatch = line.match(/group-title="([^"]*)"/);
                    const nameMatch = line.match(/tvg-name="([^"]*)"/);
                    const group = groupMatch ? groupMatch[1] : currentGroup;
                    const name = nameMatch ? nameMatch[1] : line.split(',').pop();
                    const url = lines[i + 1] ? lines[i + 1].trim() : '';

                    if (!channels[group]) {
                        channels[group] = [];
                    }
                    channels[group].push(`${name},${url}`);
                    currentGroup = group;
                }
            }

            let txtContent = '';
            for (const [group, channelList] of Object.entries(channels)) {
                txtContent += `${group},#genre#\n`;
                txtContent += channelList.join('\n') + '\n\n';
            }

            return txtContent;
        }

        function convertTXTToM3U(txtContent, epgUrl) {
            const defaultEpgUrl = "https://epg.112114.xyz/pp.xml";
            const lines = txtContent.split('\n');
            let m3uContent = `#EXTM3U x-tvg-url="${epgUrl || defaultEpgUrl}"\n`;
            let currentGenre = '未分类';

            for (const line of lines) {
                const trimmedLine = line.trim();
                if (trimmedLine.endsWith(',#genre#')) {
                    currentGenre = trimmedLine.replace(',#genre#', '');
                } else if (trimmedLine && !trimmedLine.startsWith('#')) {
                    const [channelName, channelUrl] = trimmedLine.split(',');
                    const tvgLogo = `https://epg.112114.xyz/logo/${channelName}.png`;
                    m3uContent += `#EXTINF:-1 group-title="${currentGenre}" tvg-name="${channelName}" tvg-logo="${tvgLogo}" epg-url="${epgUrl || defaultEpgUrl}",${channelName}\n`;
                    m3uContent += `${channelUrl}\n`;
                }
            }

            return m3uContent;
        }

        function downloadFile(content, filename) {
            const blob = new Blob([content], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function getCurrentDateTime() {
            const now = new Date();
            return now.getFullYear() +
                   ('0' + (now.getMonth() + 1)).slice(-2) +
                   ('0' + now.getDate()).slice(-2) +
                   ('0' + now.getHours()).slice(-2) +
                   ('0' + now.getMinutes()).slice(-2) +
                   ('0' + now.getSeconds()).slice(-2);
        }

        function getFileNameWithoutExtension(filename) {
            return filename.split('.').slice(0, -1).join('.');
        }

        document.getElementById('m3u-to-txt-form').addEventListener('submit', function(e) {
            e.preventDefault();
            const file = document.getElementById('m3u-file').files[0];
            const reader = new FileReader();
            reader.onload = function(e) {
                const m3uContent = e.target.result;
                const txtContent = parseM3UToTXT(m3uContent);
                const originalName = getFileNameWithoutExtension(file.name);
                const newFileName = `${originalName}_${getCurrentDateTime()}.txt`;
                downloadFile(txtContent, newFileName);
            };
            reader.readAsText(file);
        });

        document.getElementById('txt-to-m3u-form').addEventListener('submit', function(e) {
            e.preventDefault();
            const file = document.getElementById('txt-file').files[0];
            const epgUrl = document.getElementById('epg-url').value.trim() || "https://epg.112114.xyz/pp.xml";
            const reader = new FileReader();
            reader.onload = function(e) {
                const txtContent = e.target.result;
                const m3uContent = convertTXTToM3U(txtContent, epgUrl);
                const originalName = getFileNameWithoutExtension(file.name);
                const newFileName = `${originalName}_${getCurrentDateTime()}.m3u`;
                downloadFile(m3uContent, newFileName);
            };
            reader.readAsText(file);
        });

        // 显示通知的函数 - 用于转换操作的反馈
        function showNotification(message, isSuccess = true) {
            const notification = document.getElementById('notification');
            notification.innerHTML = `
                <i class="fa ${isSuccess ? 'fa-check-circle' : 'fa-exclamation-circle'}"></i>
                <span>${message}</span>
            `;
            notification.className = `fixed top-6 right-6 px-6 py-3 rounded-lg shadow-lg transform transition-all duration-300 flex items-center space-x-2 max-w-xs ${
                isSuccess ? 'bg-mac-green text-white' : 'bg-red-500 text-white'
            }`;
            
            // 显示通知
            setTimeout(() => {
                notification.classList.add('translate-x-0');
            }, 10);
            
            // 3秒后隐藏通知
            setTimeout(() => {
                notification.classList.remove('translate-x-0');
                notification.classList.add('translate-x-full');
            }, 3000);
        }

        // 为转换操作添加通知反馈
        document.getElementById('m3u-to-txt-form').addEventListener('submit', function() {
            showNotification('正在转换M3U到TXT...');
        });

        document.getElementById('txt-to-m3u-form').addEventListener('submit', function() {
            showNotification('正在转换TXT到M3U...');
        });
    </script>
</body>
</html>
